<template lang="pug">
.ex-code
  p.zi-subheading.code-name EXAMPLE: #[b {{ codeName }}]
  zi-card.ex-code-box
    ex-code-render(:name="name" ref="codeRender")
  details.details
    summary
      span #[Dropdown.down] Code Editor
      ex-copy-icon.copy(@click.stop.prevent="copy")
    prism(language="pug" class="ex-source-code" :code="codeTemplate")
</template>

<script>
import 'prismjs'
import 'prismjs/components/prism-pug'
import Dropdown from '@zeit-ui/vue-icons/packages/dropdown'
import ZeitUI from '../../../packages'
import Prism from 'vue-prism-component'

export default {
  name: 'ex-code',

  components: {
    Prism, Dropdown,
  },

  data: () => ({
    codeTemplate: '',
    codeName: '',
    isDark: ZeitUI.theme.getCurrentTheme().includes('dark'),
  }),

  props: {
    name: { type: String },
  },

  mounted() {
    this.codeName = this.name.split('-').reverse()[0]

    const template = this.findTemplate()
    this.codeTemplate = template && template._meta ? template._meta() : ''

    ZeitUI.theme.subscribeChange(name => this.updateTheme(name))
  },

  methods: {
    findTemplate() {
      if (!this.$refs.codeRender) return null
      const children = this.$refs.codeRender.$children
      if (!children || !children.length) return null
      return children[0]
    },

    updateTheme(name) {
      this.isDark = name.includes('dark')
    },

    async copy() {
      await this.$copyText(this.codeTemplate)
      this.$Toast.success({
        text: 'Copied to clipboard!',
      })
    },
  },
}
</script>

<style lang="stylus" src="./code.styl"></style>
<style scoped lang="stylus">
.ex-code
  margin-top 45px

.code-name
  text-transform uppercase
  font-size 12px
  margin-bottom 8px

  b
    font-size 14px

.ex-source-code
  margin-top 10px

.ex-code-box
  position relative
  padding-top var(--geist-page-margin)
  padding-bottom var(--geist-page-margin)
  border-bottom-left-radius 0
  border-bottom-right-radius 0
  overflow hidden

.details
  border-bottom-left-radius var(--geist-radius)
  border-bottom-right-radius var(--geist-radius)

  &[open]
    summary
      border-bottom none

    .down
      transform rotateZ(0deg)

    .copy
      opacity 1
      visibility visible

  summary
    padding var(--geist-gap-half) var(--geist-gap)
    border-left 1px solid var(--accents-2)
    border-bottom 1px solid var(--accents-2)
    border-right 1px solid var(--accents-2)
    display flex
    flex 1
    justify-content space-between
    align-items center

    span
      display flex
      align-items center

  pre
    border-top-left-radius 0
    border-top-right-radius 0
    margin 0
    background-color var(--geist-background)

.down
  display inline-flex
  width 12px
  height 8px
  margin-right 4px
  transform rotateZ(-90deg)
  transition all .1s ease

.copy
  transition all .1s ease-in
  color var(--accents-5)
  opacity 0
  visibility hidden
</style>
